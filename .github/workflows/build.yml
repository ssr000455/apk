name: Android Build
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Android Environment
        uses: rubyforandroid/android-actions/setup-android@v1
        with:
          ndk: false
      
      - name: Install Gradle
        run: |
          # 安装Gradle而不使用wrapper
          sudo apt install -y gradle
          # 或者使用sdkman
          curl -s "https://get.sdkman.io" | bash
          source "$HOME/.sdkman/bin/sdkman-init.sh"
          sdk install gradle 8.5
          gradle --version
      
      - name: Build APK with installed Gradle
        run: |
          # 直接使用gradle命令，不用./gradlew
          gradle :app:assembleDebug --stacktrace
      
      - name: Upload APK
        uses: actions/upload-artifact@v4
        if: success()
        with:
          name: android-app
          path: |
            app/build/outputs/apk/**/*.apk
            **/outputs/apk/**/*.apk
